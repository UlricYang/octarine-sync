# LeetCode 677 - é”®å€¼æ˜ å°„

## Step 1ï¼šé¢˜ç›®æè¿°

è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š

- `MapSum()` åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ˜ å°„
- `void insert(String key, int val)` å°†é”® `key` æ˜ å°„åˆ°å€¼ `val`ã€‚å¦‚æœ `key` å·²å­˜åœ¨ï¼Œåˆ™è¦†ç›–åŸæ¥çš„å€¼
- `int sum(String prefix)` è¿”å›æ‰€æœ‰ä»¥ `prefix` ä¸ºå‰ç¼€çš„é”®çš„å€¼çš„æ€»å’Œ

ç¤ºä¾‹ï¼š

```plaintext
è¾“å…¥ï¼š
["MapSum", "insert", "insert", "sum", "insert", "sum"]
[[], ["apple", 3], ["app", 2], ["ap"], ["apple", 2], ["ap"]]

è¾“å‡ºï¼š
[null,null,null,5,null,4]

è§£é‡Šï¼š
MapSum mapSum = new MapSum();
mapSum.insert("apple", 3);   // key="apple", val=3
mapSum.insert("app", 2);     // key="app", val=2
mapSum.sum("ap");            // è¿”å› 3 + 2 = 5ï¼ˆ"apple" å’Œ "app" éƒ½ä»¥ "ap" å¼€å¤´ï¼‰
mapSum.insert("apple", 2);   // è¦†ç›– "apple" çš„å€¼ä¸º 2
mapSum.sum("ap");            // è¿”å› 2 + 2 = 4ï¼ˆ"apple" ç°åœ¨æ˜¯ 2ï¼Œ"app" æ˜¯ 2ï¼‰
```

çº¦æŸæ¡ä»¶ï¼š

- `1 <= key.length <= 50`
- `1 <= val <= 1000`
- `1 <= prefix.length <= 50`
- `key` å’Œ `prefix` ä»…ç”±å°å†™å­—æ¯ç»„æˆ
- `insert` å’Œ `sum` è°ƒç”¨æ¬¡æ•°æ€»è®¡ä¸è¶…è¿‡ `5 Ã— 10â´`
- ç›®æ ‡ï¼šæ”¯æŒå‰ç¼€å’ŒæŸ¥è¯¢ï¼Œå®ç°ä¸€ä¸ªå¸¦å€¼ç´¯åŠ çš„é”®å€¼æ˜ å°„ç³»ç»Ÿ
- è¿é€šæ€§ï¼šæœ¬é¢˜æ˜¯ LeetCode 208ï¼ˆåŸºç¡€ Trieï¼‰å’Œ LeetCode 1804ï¼ˆå¸¦è®¡æ•° Trieï¼‰çš„å€¼ç´¯åŠ å¢å¼ºç‰ˆ

æ ¸å¿ƒæ„å›¾ï¼š
æœ¬é¢˜æ˜¯â€œTrie ä¸Šçš„å‰ç¼€å€¼æ±‚å’Œâ€çš„ç»å…¸è®¾è®¡é¢˜ï¼Œè€ƒæŸ¥å‰ç¼€è·¯å¾„å€¼ç»´æŠ¤ã€é”®å€¼è¦†ç›–æ›´æ–°ã€é«˜æ•ˆåŒºé—´æŸ¥è¯¢èƒ½åŠ›

> æœ¬è´¨æ˜¯ï¼š
>
> - æ¯ä¸ªé”®å¯¹åº”ä¸€ä¸ªæ•´æ•°å€¼
> - æ’å…¥æ—¶ï¼Œéœ€æ›´æ–°æ‰€æœ‰ç»è¿‡è¯¥é”®è·¯å¾„çš„èŠ‚ç‚¹çš„â€œå‰ç¼€å’Œâ€
> - æŸ¥è¯¢æ—¶ï¼Œåªéœ€æ‰¾åˆ°å‰ç¼€ç»ˆç‚¹ï¼Œè¿”å›å…¶å­˜å‚¨çš„æ€»å’Œ
> - é¢è¯•ä¸­é«˜åˆ†ç­”æ¡ˆéœ€æ˜ç¡®ï¼š
>   - ä¸ºä»€ä¹ˆä¸èƒ½æ¯æ¬¡ sum éƒ½éå†æ‰€æœ‰ keyï¼Ÿ
>   - å¦‚ä½•å¤„ç†é”®å€¼è¦†ç›–ï¼Ÿ
>   - å¦‚ä½•é¿å…é‡å¤è®¡ç®—ï¼Ÿ
>   - ä¸ºä»€ä¹ˆå¿…é¡»ç”¨ Trieï¼Ÿ
>   - å¦‚ä½•ä¿è¯æ›´æ–°ä¸€è‡´æ€§ï¼Ÿ

## Step 2: æ ¸å¿ƒç»“è®ºï¼ˆé‡‘å­—å¡”ç»“æ„ä¼˜åŒ–ç‰ˆï¼‰

### æ ¸å¿ƒç»“è®º

æœ¬é¢˜çš„æœ€ä¼˜è§£æ˜¯Trie + å‰ç¼€è·¯å¾„å€¼ç»´æŠ¤ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼šO(L) æ—¶é—´å†…å®Œæˆæ’å…¥ä¸æŸ¥è¯¢ã€æ”¯æŒåŠ¨æ€æ›´æ–°ã€å†…å­˜é«˜æ•ˆã€é€»è¾‘è‡ªæ´½ï¼Œæ˜¯è§£å†³â€œå‰ç¼€å€¼æ±‚å’Œâ€é—®é¢˜çš„å·¥ä¸šçº§æ ‡å‡†æ–¹æ¡ˆ

### æ”¯æ’‘è®ºç‚¹ï¼ˆMECE åˆ†ç±»ï¼‰

#### A. ç†è®ºæœ€ä¼˜æ€§ï¼šTrie æ˜¯å‰ç¼€æ±‚å’Œçš„å”¯ä¸€åˆç†ç»“æ„

- æœ¬é¢˜è¦æ±‚ï¼šå¯¹ä»»æ„å‰ç¼€ï¼Œå¿«é€Ÿè¿”å›æ‰€æœ‰ä»¥å®ƒä¸ºå‰ç¼€çš„é”®çš„å€¼ä¹‹å’Œ
- è‹¥ç”¨å“ˆå¸Œè¡¨å­˜æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ¯æ¬¡ `sum(prefix)` éœ€éå†æ‰€æœ‰é”® â†’ O(NÃ—L)ï¼Œæœ€å 5e4Ã—50=2.5e6ï¼Œå‹‰å¼ºå¯è¿‡ä½†æ— æ‰©å±•æ€§
- Trie çš„ç»“æ„ç‰¹æ€§å†³å®šï¼š
  - æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦è·¯å¾„
  - æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ª `sum` å­—æ®µï¼Œè¡¨ç¤ºæ‰€æœ‰ä»¥è¯¥èŠ‚ç‚¹ä¸ºå‰ç¼€çš„é”®çš„å€¼ä¹‹å’Œ
  - æ’å…¥é”®æ—¶ï¼Œæ²¿è·¯å¾„ç´¯åŠ æ–°å€¼ï¼›åˆ é™¤æ—§å€¼æ—¶ï¼Œå‡å»æ—§å€¼
- ä¼˜åŠ¿ï¼š
  - `insert(key, val)`ï¼šO(L) æ›´æ–°è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„ `sum`
  - `sum(prefix)`ï¼šO(L) æ‰¾åˆ°å‰ç¼€ç»ˆç‚¹ï¼Œç›´æ¥è¿”å›å…¶ `sum`
  - æ—¶é—´å¤æ‚åº¦æœ€ä¼˜ï¼šä»»ä½•ç®—æ³•å¿…é¡»è‡³å°‘è®¿é—®æ¯ä¸ªå­—ç¬¦ä¸€æ¬¡
  - ç©ºé—´æ•ˆç‡é«˜ï¼šå…±äº«å‰ç¼€ï¼Œå†…å­˜å ç”¨å°

> âœ… å…³é”®æ´å¯Ÿï¼š
>
> - å¦‚æœæˆ‘ä»¬æ¯æ¬¡ `sum("ap")` éƒ½éå†æ‰€æœ‰ keyï¼Œæ‰¾å‰ç¼€ â†’ æ—¶é—´å¤æ‚åº¦ O(NÃ—L)
> - ä½¿ç”¨ Trie + è·¯å¾„å’Œï¼š
>   - æ’å…¥ "apple"=3ï¼šè·¯å¾„ aâ†’pâ†’pâ†’lâ†’eï¼Œæ¯ä¸ªèŠ‚ç‚¹ sum +=3
>   - æ’å…¥ "app"=2ï¼šè·¯å¾„ aâ†’pâ†’pï¼Œæ¯ä¸ªèŠ‚ç‚¹ sum +=2
>   - æŸ¥è¯¢ "ap"ï¼šèµ°åˆ°ç¬¬äºŒä¸ª pï¼Œè¿”å›å…¶ sum=5
>   - æ›´æ–° "apple"=2ï¼šåŸå€¼æ˜¯ 3ï¼Œå·®å€¼æ˜¯ -1ï¼Œè·¯å¾„ä¸Šæ¯ä¸ªèŠ‚ç‚¹ sum -=1
>   - æŸ¥è¯¢ "ap"ï¼šsum=4
> - æ•´ä¸ªç³»ç»Ÿæ— éœ€æ‰«æä»»ä½•é”®ï¼Œåªé è·¯å¾„å’Œæ›´æ–° â†’ æ€§èƒ½æå‡ 100 å€

#### B. å¯¹æ¯”åŠ£åŠ¿æ€§ï¼šå…¶ä»–ä¸»æµæ–¹æ³•å‡å­˜åœ¨ç»“æ„æ€§ç¼ºé™·

| æ–¹æ³•                                    | é—®é¢˜                                                                                   | ä¸ºä½•æ¬¡ä¼˜                              |
| --------------------------------------- | -------------------------------------------------------------------------------------- | ------------------------------------- |
| å“ˆå¸Œè¡¨ + éå†æ‰€æœ‰ key                   | æ¯æ¬¡ sum éœ€éå†æ‰€æœ‰é”®ï¼Œæ£€æŸ¥æ˜¯å¦ä»¥ prefix å¼€å¤´ â†’ O(NÃ—L)                                 | æœ€å 5e4Ã—50=2.5e6ï¼Œå¯èƒ½è¶…æ—¶ï¼Œæ— æ³•æ‰©å±• |
| ä¸ºæ¯ä¸ª prefix é¢„è®¡ç®—æ€»å’Œ                | æ’å…¥ä¸€ä¸ªé”®éœ€æ›´æ–°æ‰€æœ‰å‰ç¼€ï¼ˆå¦‚ "apple" è¦æ›´æ–° "a", "ap", "app", "appl", "apple"ï¼‰â†’ O(LÂ²) | æ’å…¥å¤æ‚åº¦ä¸Šå‡ï¼Œå†…å­˜æµªè´¹ï¼Œå®ç°å¤æ‚    |
| ä½¿ç”¨æ•°æ®åº“ç´¢å¼•                          | é¢è¯•è¦æ±‚â€œè®¾è®¡æ•°æ®ç»“æ„â€ï¼Œä¸å…è®¸ä¾èµ–å¤–éƒ¨ç³»ç»Ÿ                                             | ä¸ç¬¦åˆé¢˜ç›®æ„å›¾                        |
| ä½¿ç”¨å­—å…¸æ ‘ä½†åªå­˜é”®ï¼Œsum æ—¶ DFS éå†å­æ ‘ | æ’å…¥ O(L)ï¼Œsum æ—¶ O(N_sub Ã— L)ï¼Œæœ€å O(NÃ—L)                                            | å¯èƒ½éå†å…¨éƒ¨èŠ‚ç‚¹ï¼Œæ•ˆç‡ä½äºè·¯å¾„å’Œ      |

> âœ… å…³é”®æ´å¯Ÿï¼š
>
> - è·¯å¾„å’Œï¼ˆpathSumï¼‰æ˜¯â€œé¢„è®¡ç®—çš„ç´¯åŠ å’Œâ€ï¼Œæœ¬è´¨æ˜¯åŠ¨æ€è§„åˆ’çš„å‰ç¼€å’Œæ€æƒ³
> - æ¯ä¸ªèŠ‚ç‚¹çš„ `sum` = æ‰€æœ‰ä»¥å®ƒä¸ºå‰ç¼€çš„é”®çš„å€¼ä¹‹å’Œ
> - æ’å…¥æ—¶ï¼š`delta = new_val - old_val`ï¼Œè·¯å¾„ä¸Šæ¯ä¸ªèŠ‚ç‚¹ `sum += delta`
> - æŸ¥è¯¢æ—¶ï¼šç›´æ¥è¯»å–å‰ç¼€ç»ˆç‚¹çš„ `sum` â†’ O(1) æŸ¥è¯¢ï¼ŒO(L) æ›´æ–°
> - è¿™æ˜¯â€œæ ‘ä¸Šå·®åˆ†â€çš„ç»å…¸åº”ç”¨

#### C. é€‚ç”¨è¾¹ç•Œï¼šæ˜ç¡®çº¦æŸå‰æï¼Œé¿å…æ³›åŒ–è¯¯ç”¨

- âœ… é€‚ç”¨ï¼šé”®å€¼æ›´æ–°ä¸ºè¦†ç›–ï¼ˆéç´¯åŠ ï¼‰ï¼Œéœ€å‰ç¼€å’ŒæŸ¥è¯¢
- âœ… é€‚ç”¨ï¼šé”®é•¿åº¦çŸ­ï¼ˆâ‰¤50ï¼‰ï¼Œæ€»æ“ä½œæ•°ä¸­ç­‰ï¼ˆâ‰¤5e4ï¼‰
- âœ… é€‚ç”¨ï¼šé”®ç”±å°å†™å­—æ¯ç»„æˆ
- âš ï¸ éœ€è°ƒæ•´ï¼šè‹¥å€¼å¯ç´¯åŠ ï¼ˆä¸æ˜¯è¦†ç›–ï¼‰â†’ æ— éœ€è®°å½•æ—§å€¼ï¼Œç›´æ¥åŠ 
- âš ï¸ éœ€è°ƒæ•´ï¼šè‹¥è¦æ”¯æŒåˆ é™¤é”® â†’ éœ€è®°å½•æ¯ä¸ªé”®çš„å½“å‰å€¼ï¼Œä»¥ä¾¿å‡å»
- âŒ ä¸é€‚ç”¨ï¼šè‹¥å‰ç¼€æŸ¥è¯¢è¦è¿”å›æ‰€æœ‰é”®åˆ—è¡¨ â†’ éœ€ DFS éå†å­æ ‘
- âŒ ä¸é€‚ç”¨ï¼šè‹¥é”®å«ç©ºæ ¼ã€Unicode â†’ éœ€æ”¹ç”¨ Map\<Character, Trie>

#### D. å·¥ç¨‹å®è·µä»·å€¼ï¼šç¬¦åˆå¤§å‚ç®—æ³•é¢è¯•è¯„åˆ†æ ‡å‡†

- âœ… ç®€æ´æ€§ï¼šåœ¨åŸºç¡€ Trie ä¸Šå¢åŠ  `sum` å­—æ®µ + å·®å€¼æ›´æ–°ï¼Œé€»è¾‘æ¸…æ™°
- âœ… å¯è¯æ€§ï¼šæ›´æ–°æ“ä½œæ˜¯â€œå·®å€¼ä¼ æ’­â€ï¼Œæ’å…¥å’Œè¦†ç›–å¯¹ç§°ï¼Œä¸€è‡´æ€§å¯è¯
- âœ… å¯æ‰©å±•æ€§ï¼šåŒä¸€æ¨¡å¼å¯è¿ç§»è‡³â€œåŒºåŸŸæ±‚å’Œâ€ã€â€œå‰ç¼€è®¡æ•°â€ã€â€œè¯é¢‘ç»Ÿè®¡â€
- âœ… è¡¨è¾¾åŠ›ï¼šåœ¨é¢è¯•ä¸­èƒ½è‡ªç„¶å¼•å‡ºï¼š
  - â€œä¸ºä»€ä¹ˆä¸ç”¨å“ˆå¸Œï¼Ÿâ€
  - â€œæ’å…¥ä¸€ä¸ªé”®ï¼Œæ›´æ–°å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Ÿâ€
  - â€œå¦‚æœè¦†ç›–å€¼ï¼Œæ€ä¹ˆçŸ¥é“æ—§å€¼ï¼Ÿâ€
  - â€œsum æ“ä½œä¼šä¸ä¼šæ…¢ï¼Ÿâ€
  - â€œå¦‚æœæ’å…¥å¾ˆå¤šé”®ï¼Œå†…å­˜ä¼šä¸ä¼šçˆ†ç‚¸ï¼Ÿâ€
    â†’ å±•ç°åŠ¨æ€æ•°æ®ç»“æ„è®¾è®¡èƒ½åŠ›ä¸çŠ¶æ€ç»´æŠ¤æ€ç»´

### æ€»ç»“

å› æ­¤ï¼ŒTrie + å‰ç¼€è·¯å¾„å€¼ç»´æŠ¤ æ˜¯æœ¬é¢˜åœ¨ç†è®ºæ­£ç¡®æ€§ã€æ—¶é—´/ç©ºé—´æ•ˆç‡å’Œå·¥ç¨‹å®ç°å¤æ‚åº¦ä¸Šçš„æœ€ä¼˜å¹³è¡¡ç‚¹

## Step 3: å¤šè¯­è¨€å®ç°

### Go ğŸ¹

```go
type MapSum struct {
    children [26]*MapSum
    sum      int // ä»¥è¯¥èŠ‚ç‚¹ä¸ºå‰ç¼€çš„æ‰€æœ‰é”®çš„å€¼ä¹‹å’Œ
    val      int // è¯¥é”®å¯¹åº”çš„å€¼ï¼ˆç”¨äºè¦†ç›–æ›´æ–°ï¼‰
}

func Constructor() MapSum {
    return MapSum{}
}

func (ms *MapSum) Insert(key string, val int) {
    // è®¡ç®—å·®å€¼ï¼šæ–°å€¼ - æ—§å€¼
    delta := val
    node := ms
    for _, char := range key {
        index := char - 'a'
        if node.children[index] == nil {
            node.children[index] = &MapSum{}
        }
        node = node.children[index]
        delta -= node.val // å‡å»æ—§å€¼ï¼Œå¾—åˆ°å‡€å¢é‡
    }
    // æ²¿è·¯å¾„æ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„ sum
    node = ms
    for _, char := range key {
        index := char - 'a'
        node = node.children[index]
        node.sum += delta
    }
    // æ›´æ–°ç»ˆç‚¹çš„ val
    node.val = val
}

func (ms *MapSum) Sum(prefix string) int {
    node := ms
    for _, char := range prefix {
        index := char - 'a'
        if node.children[index] == nil {
            return 0 // å‰ç¼€ä¸å­˜åœ¨
        }
        node = node.children[index]
    }
    return node.sum // ç›´æ¥è¿”å›å‰ç¼€ç»ˆç‚¹çš„ sum
}
```

### Python ğŸ

```python
class MapSum:
    def __init__(self):
        self.children = [None] * 26
        self.sum = 0      # ä»¥è¯¥èŠ‚ç‚¹ä¸ºå‰ç¼€çš„æ‰€æœ‰é”®çš„å€¼ä¹‹å’Œ
        self.val = 0      # è¯¥é”®å¯¹åº”çš„å€¼ï¼ˆç”¨äºè¦†ç›–æ›´æ–°ï¼‰

    def insert(self, key: str, val: int) -> None:
        # æ‰¾åˆ°ç»ˆç‚¹ï¼Œè·å–æ—§å€¼
        node = self
        for char in key:
            index = ord(char) - ord('a')
            if node.children[index] is None:
                node.children[index] = MapSum()
            node = node.children[index]

        delta = val - node.val  # è®¡ç®—å·®å€¼ï¼šæ–°å€¼ - æ—§å€¼

        # é‡æ–°éå†è·¯å¾„ï¼Œæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„ sum
        node = self
        for char in key:
            index = ord(char) - ord('a')
            node = node.children[index]
            node.sum += delta

        # æ›´æ–°ç»ˆç‚¹çš„ val
        node.val = val

    def sum(self, prefix: str) -> int:
        node = self
        for char in prefix:
            index = ord(char) - ord('a')
            if node.children[index] is None:
                return 0
            node = node.children[index]
        return node.sum
```

### TypeScript ğŸŸ¦

```typescript
class MapSum {
  children: (MapSum | null)[];
  sum: number;
  val: number;

  constructor() {
    this.children = new Array(26).fill(null);
    this.sum = 0;
    this.val = 0;
  }

  insert(key: string, val: number): void {
    // å…ˆæ‰¾åˆ°ç»ˆç‚¹ï¼Œè·å–æ—§å€¼
    let node: MapSum | null = this;
    for (const char of key) {
      const index = char.charCodeAt(0) - "a".charCodeAt(0);
      if (node.children[index] === null) {
        node.children[index] = new MapSum();
      }
      node = node.children[index]!;
    }

    const delta = val - node.val; // æ–°å€¼ - æ—§å€¼

    // é‡æ–°éå†è·¯å¾„ï¼Œæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„ sum
    node = this;
    for (const char of key) {
      const index = char.charCodeAt(0) - "a".charCodeAt(0);
      node = node.children[index]!;
      node.sum += delta;
    }

    // æ›´æ–°ç»ˆç‚¹çš„ val
    node.val = val;
  }

  sum(prefix: string): number {
    let node: MapSum | null = this;
    for (const char of prefix) {
      const index = char.charCodeAt(0) - "a".charCodeAt(0);
      if (node.children[index] === null) {
        return 0;
      }
      node = node.children[index]!;
    }
    return node.sum;
  }
}
```

### Rust ğŸ¦€

```rust
#[derive(Default)]
struct MapSum {
    children: [Option<Box<MapSum>>; 26],
    sum: i32,
    val: i32,
}

impl MapSum {
    fn new() -> Self {
        Self::default()
    }

    fn insert(&mut self, key: String, val: i32) {
        // å…ˆæ‰¾åˆ°ç»ˆç‚¹ï¼Œè·å–æ—§å€¼
        let mut node = self;
        for c in key.chars() {
            let index = (c as u8 - b'a') as usize;
            if node.children[index].is_none() {
                node.children[index] = Some(Box::new(MapSum::new()));
            }
            node = node.children[index].as_mut().unwrap();
        }

        let delta = val - node.val; // æ–°å€¼ - æ—§å€¼

        // é‡æ–°éå†è·¯å¾„ï¼Œæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹çš„ sum
        node = self;
        for c in key.chars() {
            let index = (c as u8 - b'a') as usize;
            node = node.children[index].as_mut().unwrap();
            node.sum += delta;
        }

        // æ›´æ–°ç»ˆç‚¹çš„ val
        node.val = val;
    }

    fn sum(&self, prefix: String) -> i32 {
        let mut node = self;
        for c in prefix.chars() {
            let index = (c as u8 - b'a') as usize;
            match &node.children[index] {
                Some(child) => node = child,
                None => return 0,
            }
        }
        node.sum
    }
}
```

### ç®—æ³•æ·±å…¥è§£æï¼ˆè´¹æ›¼å¼ä¸‰å±‚ç»“æ„ï¼‰

ç¬¬ä¸€å±‚ï¼šä¸€å¥è¯è®²æ˜ç™½ â€”â€”

> å°±åƒä½ æœ‰ä¸€ä¸ªè¯å…¸ï¼Œæ¯ä¸ªè¯æœ‰ä¸€ä¸ªåˆ†æ•°ï¼Œä½ æƒ³çŸ¥é“æ‰€æœ‰ä»¥ "ap" å¼€å¤´çš„è¯çš„åˆ†æ•°æ€»å’Œ
> ä½ ä¸ç”¨ä¸€ä¸ªä¸ªæŸ¥ï¼Œä½ æŠŠæ¯ä¸ªèŠ‚ç‚¹éƒ½è®°ä¸€ä¸ªâ€œæ€»åˆ†â€ï¼š
>
> - "a" èŠ‚ç‚¹æ€»åˆ† = æ‰€æœ‰ä»¥ a å¼€å¤´çš„è¯çš„åˆ†æ•°å’Œ
> - "ap" èŠ‚ç‚¹æ€»åˆ† = æ‰€æœ‰ä»¥ ap å¼€å¤´çš„è¯çš„åˆ†æ•°å’Œ
> - æ’å…¥ "apple"=3 â†’ "a"ã€"ap"ã€"app"ã€"appl"ã€"apple" çš„æ€»åˆ†éƒ½ +3
> - æ’å…¥ "app"=2 â†’ "a"ã€"ap"ã€"app" çš„æ€»åˆ†éƒ½ +2
> - æŸ¥è¯¢ "ap" â†’ ç›´æ¥è¯» "ap" èŠ‚ç‚¹çš„æ€»åˆ† = 5
> - ä¿®æ”¹ "apple"=2 â†’ å·®å€¼ -1 â†’ æ‰€æœ‰è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ€»åˆ†éƒ½ -1
>   â€”â€” è¿™å°±æ˜¯Trie ä¸Šçš„è·¯å¾„å’Œç»´æŠ¤

ç¬¬äºŒå±‚ï¼šæ‰‹æŠŠæ‰‹æ•™ä½ å†™ â€”â€”
æˆ‘ä»¬ä¸æ˜¯åœ¨â€œå»ºæ ‘â€ï¼Œè€Œæ˜¯åœ¨â€œå»ºåŠ¨æ€å‰ç¼€å’Œâ€

- ä¸ºä»€ä¹ˆéœ€è¦ `val` å­—æ®µï¼Ÿä¸èƒ½åªç”¨ `sum` å—ï¼Ÿ
  - å› ä¸º `insert` æ˜¯è¦†ç›–æ“ä½œï¼Œä¸æ˜¯ç´¯åŠ 
  - å¦‚æœæ’å…¥ "apple"=3ï¼Œå†æ’å…¥ "apple"=2ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å• +2ï¼Œè€Œæ˜¯è¦ï¼š
    - æ—§å€¼ = 3ï¼Œæ–°å€¼ = 2 â†’ å·®å€¼ = -1
    - æ‰€æœ‰ç»è¿‡ "apple" çš„èŠ‚ç‚¹ï¼Œsum -=1
  - å¦‚æœæ²¡æœ‰ `val`ï¼Œæˆ‘ä»¬ä¸çŸ¥é“æ—§å€¼ï¼Œå°±æ— æ³•è®¡ç®—å·®å€¼
  - `val` æ˜¯å·®å€¼è®¡ç®—çš„é”šç‚¹ï¼Œæ²¡æœ‰å®ƒï¼Œç³»ç»Ÿæ— æ³•æ”¯æŒè¦†ç›–æ›´æ–°

- ä¸ºä»€ä¹ˆæ’å…¥è¦éå†ä¸¤æ¬¡ï¼Ÿä¸èƒ½ä¸€æ¬¡å®Œæˆï¼Ÿ
  - ç¬¬ä¸€æ¬¡éå†ï¼šæ‰¾åˆ°ç»ˆç‚¹ï¼Œè·å–æ—§å€¼
  - ç¬¬äºŒæ¬¡éå†ï¼šç”¨å·®å€¼æ›´æ–°æ‰€æœ‰è·¯å¾„èŠ‚ç‚¹çš„ `sum`
  - ä¸ºä»€ä¹ˆä¸èƒ½åˆå¹¶ï¼Ÿ
    - å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“è·¯å¾„ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„æ—§å€¼ï¼ŒåªçŸ¥é“ç»ˆç‚¹çš„æ—§å€¼
    - æ‰€æœ‰èŠ‚ç‚¹çš„ `sum` éƒ½ä¾èµ–äºæ‰€æœ‰ä»¥å®ƒä¸ºå‰ç¼€çš„é”®çš„å€¼ï¼Œåªæœ‰ç»ˆç‚¹çš„ `val` æ˜¯ç›´æ¥å­˜å‚¨çš„
    - æ‰€ä»¥å¿…é¡»ï¼šå…ˆç®—å·®å€¼ â†’ å†ä¼ æ’­å·®å€¼
  - è¿™æ˜¯å·®åˆ†ä¼ æ’­çš„ç»å…¸æ¨¡å¼ï¼šå…ˆè®¡ç®—å˜åŒ–é‡ï¼Œå†ç»Ÿä¸€æ›´æ–°

- ä¸ºä»€ä¹ˆ sum ä¸æ˜¯å­èŠ‚ç‚¹ sum ä¹‹å’Œï¼Ÿ
  - `sum` å­—æ®µè¡¨ç¤ºâ€œæ‰€æœ‰ä»¥è¯¥èŠ‚ç‚¹ä¸ºå‰ç¼€çš„é”®çš„å€¼ä¹‹å’Œâ€ï¼Œä¸æ˜¯å­æ ‘çš„ `sum` æ€»å’Œ
  - ä¾‹å¦‚ï¼š
    - æ’å…¥ "apple"=3ï¼š
      - a.sum = 3
      - ap.sum = 3
      - app.sum = 3
      - appl.sum = 3
      - apple.sum = 3
    - æ’å…¥ "app"=2ï¼š
      - a.sum = 3+2=5
      - ap.sum = 3+2=5
      - app.sum = 3+2=5
    - æ³¨æ„ï¼šappl å’Œ apple çš„ sum ä»ç„¶æ˜¯ 3ï¼Œå› ä¸º "app" ä¸ç»è¿‡å®ƒä»¬
  - æ‰€ä»¥ `sum` æ˜¯è·¯å¾„ä¸Šçš„ç´¯åŠ ï¼Œä¸æ˜¯å­æ ‘çš„é€’å½’æ±‚å’Œ
  - å…³é”®ï¼šæˆ‘ä»¬åªåœ¨â€œè¯¥èŠ‚ç‚¹æ˜¯æŸä¸ªé”®çš„ç»ˆç‚¹æ—¶â€æ‰å¢åŠ å®ƒçš„è´¡çŒ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹

- ä¸ºä»€ä¹ˆæ›´æ–°æ˜¯â€œåŠ å·®å€¼â€è€Œä¸æ˜¯â€œè®¾ä¸ºæ–°å€¼â€ï¼Ÿ
  - å› ä¸ºå¤šä¸ªé”®å…±äº«å‰ç¼€ï¼
  - ä¾‹å¦‚ï¼ša.sum = "apple" + "app" + "a" çš„å€¼ä¹‹å’Œ
  - å¦‚æœæˆ‘ä»¬ç›´æ¥è®¾ a.sum = new_valï¼Œå°±è¦†ç›–äº†å…¶ä»–é”®çš„è´¡çŒ®
  - åªæœ‰â€œå·®å€¼ä¼ æ’­â€èƒ½ä¿è¯ï¼š
    - æ–°å€¼è´¡çŒ® = delta
    - æ—§å€¼ç§»é™¤ = -old_val
    - å…¶ä»–é”®ä¸å—å½±å“

- ä¸ºä»€ä¹ˆ Rust/Go è¦ç”¨ `as_mut()`ï¼ŸPython/TS ç”¨ `node.children[index]`ï¼Ÿ
  - Rustï¼š`Option<Box<T>>`ï¼Œéœ€è¦ `.as_mut()` è·å–å¯å˜å¼•ç”¨
  - Goï¼šæŒ‡é’ˆç›´æ¥èµ‹å€¼
  - Pythonï¼šå¯¹è±¡å¼•ç”¨ï¼Œç›´æ¥èµ‹å€¼
  - TSï¼šæ–­è¨€éç©ºåç›´æ¥è®¿é—®
  - æœ¬è´¨ä¸€è‡´ï¼šéƒ½æ˜¯åœ¨æ›´æ–°åŒä¸€ä¸ªèŠ‚ç‚¹çš„å­—æ®µ

- ä¸ºä»€ä¹ˆä¸æ˜¯ DFS éå†æ‰€æœ‰ä»¥ prefix å¼€å¤´çš„é”®æ¥æ±‚å’Œï¼Ÿ
  - å¦‚æœæˆ‘ä»¬æ¯æ¬¡ sum éƒ½ DFS éå†å­æ ‘ï¼š
    - æ’å…¥ 1000 ä¸ªé”®ï¼Œsum ä¸€æ¬¡å¯èƒ½è¦éå† 1000 ä¸ªèŠ‚ç‚¹
    - æ€»æ—¶é—´ O(NÃ—L)
  - è€Œæˆ‘ä»¬ç”¨è·¯å¾„å’Œï¼š
    - æ’å…¥ O(L)ï¼Œsum O(L)
    - æ€»æ—¶é—´ O((N+Q)Ã—L)ï¼Œçº¿æ€§å…³ç³»ï¼Œè¿œä¼˜äº O(NÃ—QÃ—L)
  - è¿™æ˜¯å…¸å‹çš„â€œé¢„è®¡ç®—â€æ€æƒ³ï¼šç©ºé—´æ¢æ—¶é—´

- ä¸ºä»€ä¹ˆä¸ä¼šå‡ºç° sum è®¡ç®—é”™è¯¯ï¼Ÿ
  - æ’å…¥å’Œè¦†ç›–æ“ä½œæ˜¯å¯¹ç§°çš„ï¼š
    - æ’å…¥ "a"=1ï¼ša.sum=1
    - æ’å…¥ "a"=2ï¼šdelta=1ï¼Œa.sum=2
    - æ’å…¥ "ab"=3ï¼ša.sum=2+3=5, ab.sum=3
    - æ’å…¥ "a"=5ï¼šdelta=3ï¼Œa.sum=5+3=8, ab.sum=3
  - æ¯æ¬¡æ“ä½œéƒ½ç²¾ç¡®è®¡ç®—â€œå‡€å˜åŒ–é‡â€ï¼Œå¹¶ä¼ æ’­åˆ°æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹
  - æ‰€æœ‰èŠ‚ç‚¹çš„ sum éƒ½æ˜¯å±€éƒ¨ä¸€è‡´çš„
  - è¯æ˜ï¼šå½’çº³æ³•
    - åŸºç¡€ï¼šç©ºæ ‘ï¼Œæ‰€æœ‰ sum=0
    - å‡è®¾æ’å…¥å‰æ‰€æœ‰ sum æ­£ç¡®
    - æ’å…¥åï¼Œæ¯ä¸ªèŠ‚ç‚¹ sum += deltaï¼Œdelta æ˜¯è¯¥é”®çš„å‡€å˜åŒ–
    - åˆ™æ–° sum = åŸ sum + æ–°é”®è´¡çŒ® - æ—§é”®è´¡çŒ® = æ­£ç¡®å€¼

ç¬¬ä¸‰å±‚ï¼šä¸ºä»€ä¹ˆè¿™æ ·æœ€å¥½ â€”â€”
è¿™ä¸æ˜¯â€œæ ‘â€ï¼Œè€Œæ˜¯ä¸€ä¸ªå¸¦å·®åˆ†æ›´æ–°çš„å‰ç¼€å’Œæœºå™¨

- æ•°å­¦æœ¬è´¨ï¼š
  - æ¯ä¸ªèŠ‚ç‚¹çš„ `sum` æ˜¯ä¸€ä¸ªå‰ç¼€å’Œæ•°ç»„ï¼š
    - `sum[node] = Î£{ val[key] | key çš„å‰ç¼€æ˜¯ node è·¯å¾„ }`
  - æ’å…¥æ“ä½œ = åœ¨è·¯å¾„ä¸Šåšå·®åˆ†æ›´æ–°
  - æŸ¥è¯¢æ“ä½œ = å‰ç¼€å’ŒæŸ¥è¯¢ â†’ O(1) è¯»å–
  - è¿™æ­£æ˜¯å·®åˆ†æ•°ç»„ + å‰ç¼€å’Œåœ¨æ ‘ç»“æ„ä¸Šçš„æ¨å¹¿

- çŠ¶æ€å®šä¹‰ï¼š
  - `children[26]`ï¼šå­—ç¬¦è½¬ç§»
  - `sum`ï¼šä»¥è¯¥èŠ‚ç‚¹ä¸ºå‰ç¼€çš„æ‰€æœ‰é”®çš„å€¼ä¹‹å’Œ
  - `val`ï¼šè¯¥èŠ‚ç‚¹ä½œä¸ºé”®ç»ˆç‚¹æ—¶çš„å€¼ï¼ˆç”¨äºè¦†ç›–è®¡ç®—ï¼‰
  - ä¸å˜é‡ï¼š
    - `sum = æ‰€æœ‰ä»¥è¯¥èŠ‚ç‚¹ä¸ºå‰ç¼€çš„é”®çš„ val ä¹‹å’Œ`
    - å½“æ’å…¥ä¸€ä¸ªé”®æ—¶ï¼Œå…¶æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹çš„ sum éƒ½ä¼šåŠ ä¸Š `delta = new_val - old_val`
    - `val` ä»…åœ¨ç»ˆç‚¹èŠ‚ç‚¹æœ‰æ„ä¹‰

- ç®—æ³•ç­–ç•¥ï¼š
  1. Insert(key, val)ï¼š
     - éå† key è·¯å¾„ï¼Œæ‰¾åˆ°ç»ˆç‚¹ï¼Œè·å– `old_val`
     - è®¡ç®— `delta = val - old_val`
     - é‡æ–°éå†è·¯å¾„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ `sum += delta`
     - è®¾ç½®ç»ˆç‚¹ `val = val`
  1. Sum(prefix)ï¼š
     - éå† prefix è·¯å¾„ï¼Œè‹¥ä¸­æ–­è¿”å› 0
     - å¦åˆ™è¿”å›ç»ˆç‚¹èŠ‚ç‚¹çš„ `sum`

- å·¥ç¨‹ä¼˜åŠ¿ï¼š
  - æ—¶é—´å¤æ‚åº¦ï¼š
    - `insert`ï¼šO(L)
    - `sum`ï¼šO(L)
    - æ€»å¤æ‚åº¦ï¼šO((N + Q) Ã— L)ï¼ŒL=50ï¼ŒN+Qâ‰¤5e4 â†’ æœ€å¤§ 2.5e6ï¼Œæé«˜æ•ˆ
  - ç©ºé—´å¤æ‚åº¦ï¼šO(MÃ—L)ï¼ŒM=å”¯ä¸€é”®æ•°ï¼ŒL=å¹³å‡é•¿åº¦
  - å¯æ‰©å±•æ€§ï¼š
    - å¯è½»æ¾æ”¹ä¸ºâ€œåŒºé—´å’Œâ€ï¼šåŠ  `start`ã€`end` å­—æ®µ
    - å¯æ”¯æŒâ€œåˆ é™¤é”®â€ï¼šä¸è¦†ç›–åŒç†
    - å¯æ”¯æŒâ€œé”®å€¼ç´¯åŠ â€ï¼šæ— éœ€ `val`ï¼Œç›´æ¥ `sum += val`
    - å¯æ”¯æŒâ€œå‰ç¼€æœ€å¤§å€¼â€ï¼šæ¯ä¸ªèŠ‚ç‚¹å­˜ `max_val`
  - é¢è¯•åŠ åˆ†ï¼šèƒ½è§£é‡Šâ€œä¸ºä»€ä¹ˆæ˜¯å·®åˆ†â€ã€â€œä¸ºä»€ä¹ˆä¸æ˜¯é€’å½’æ±‚å’Œâ€ã€â€œå¦‚ä½•ä¿è¯ä¸€è‡´æ€§â€ã€â€œä¸ºä½•ä¸æš´åŠ›â€

â†’ è¿™å°±æ˜¯å‰ç¼€å’Œæ˜ å°„çš„é»„é‡‘æ¨¡å‹ï¼šTrie + å·®åˆ†ä¼ æ’­

## Step 4: ä¼ªä»£ç ä¸å¯è§†åŒ–

### ä¼ªä»£ç 

```
å‡½æ•° MapSum():
    åˆå§‹åŒ– children æ•°ç»„ï¼ˆ26ä¸ªå…ƒç´ ï¼Œå…¨ä¸º nullï¼‰
    åˆå§‹åŒ– sum = 0
    åˆå§‹åŒ– val = 0

å‡½æ•° insert(key, val):
    node = æ ¹èŠ‚ç‚¹
    // ç¬¬ä¸€æ¬¡éå†ï¼šæ‰¾åˆ°ç»ˆç‚¹ï¼Œè·å–æ—§å€¼
    å¯¹äº key ä¸­æ¯ä¸ªå­—ç¬¦ cï¼š
        index = c - 'a'
        å¦‚æœ node.children[index] ä¸º nullï¼š
            åˆ›å»ºæ–°èŠ‚ç‚¹
        node = node.children[index]
    old_val = node.val
    delta = val - old_val

    // ç¬¬äºŒæ¬¡éå†ï¼šæ›´æ–°è·¯å¾„ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„ sum
    node = æ ¹èŠ‚ç‚¹
    å¯¹äº key ä¸­æ¯ä¸ªå­—ç¬¦ cï¼š
        index = c - 'a'
        node = node.children[index]
        node.sum += delta

    // æ›´æ–°ç»ˆç‚¹çš„ val
    node.val = val

å‡½æ•° sum(prefix):
    node = æ ¹èŠ‚ç‚¹
    å¯¹äº prefix ä¸­æ¯ä¸ªå­—ç¬¦ cï¼š
        index = c - 'a'
        å¦‚æœ node.children[index] ä¸º nullï¼š
            è¿”å› 0
        node = node.children[index]
    è¿”å› node.sum
```

### Mermaid çŠ¶æ€è½¬ç§»å›¾ï¼ˆç¤ºä¾‹ï¼šinsert("apple",3), insert("app",2), insert("apple",2)ï¼‰

```mermaid
graph TD
    A[æ ¹] --> B[a: sum=3, val=0]
    B --> C[ap: sum=3, val=0]
    C --> D[app: sum=3, val=0]
    D --> E[appl: sum=3, val=0]
    E --> F[apple: sum=3, val=3]

    A --> G[ap: sum=5, val=0] %% æ’å…¥ "app"=2 åï¼Œa å’Œ ap çš„ sum æ›´æ–°
    G --> H[app: sum=5, val=2]
    H --> I[appl: sum=3, val=0] %% appl ä¸è¢« app å½±å“
    I --> J[apple: sum=3, val=3]

    A --> K[a: sum=5, val=0] %% æ’å…¥ "apple"=2 åï¼Œå·®å€¼ delta=-1
    K --> L[ap: sum=4, val=0]
    L --> M[app: sum=4, val=2]
    M --> N[appl: sum=2, val=0]
    N --> O[apple: sum=2, val=2]

    style A fill:#fff,stroke:#333
    style B fill:#fff,stroke:#333
    style C fill:#fff,stroke:#333
    style D fill:#fff,stroke:#333
    style E fill:#fff,stroke:#333
    style F fill:#cfc,stroke:#333
    style H fill:#cfc,stroke:#333
    style M fill:#cfc,stroke:#333
    style O fill:#cfc,stroke:#333

    %% æŸ¥è¯¢ sum("ap") â†’ è¿”å› ap.sum=4
    P[æŸ¥è¯¢ "ap"] --> L[ap: sum=4] --> Q[è¿”å› 4]
```

> å›¾ç¤ºè¯´æ˜ï¼š
>
> - æ¯ä¸ªèŠ‚ç‚¹æ ‡æ³¨ `sum=å€¼, val=å€¼`
> - æ’å…¥ "apple"=3ï¼šè·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹ sum +=3
> - æ’å…¥ "app"=2ï¼šè·¯å¾„ aâ†’pâ†’p ä¸Šæ‰€æœ‰èŠ‚ç‚¹ sum +=2
> - æ’å…¥ "apple"=2ï¼šdelta = 2 - 3 = -1ï¼Œè·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹ sum -=1
> - æŸ¥è¯¢ "ap"ï¼šè¿”å› ap.sum = 3+2-1 = 4
> - å®Œç¾ä½“ç°å·®åˆ†ä¼ æ’­ä¸è·¯å¾„å…±äº«

## Step 5: æ‰§è¡Œè¿‡ç¨‹æ¼”ç¤º

æˆ‘ä»¬å°†æ¨¡æ‹Ÿ Go å®ç°å¯¹ç¤ºä¾‹çš„å®Œæ•´æ‰§è¡Œè½¨è¿¹ï¼š

### A æ‰§è¡Œç¯å¢ƒè®¾å®š

```go
mapSum := Constructor()
mapSum.Insert("apple", 3)
mapSum.Insert("app", 2)
mapSum.Sum("ap")   // æœŸæœ› 5
mapSum.Insert("apple", 2)
mapSum.Sum("ap")   // æœŸæœ› 4
```

### B æ‰§è¡Œè½¨è¿¹è¡¨æ ¼ï¼ˆé€æ“ä½œæ¨¡æ‹Ÿï¼‰

| æ­¥éª¤ | æ“ä½œ        | å‚æ•°       | è·¯å¾„èŠ‚ç‚¹     | æ—§å€¼ | æ–°å€¼ | delta | æ›´æ–°èŠ‚ç‚¹ï¼ˆsum += deltaï¼‰ | è¿”å›å€¼   |
| ---- | ----------- | ---------- | ------------ | ---- | ---- | ----- | ------------------------ | -------- |
| 1    | Constructor | â€”          | â€”            | â€”    | â€”    | â€”     | â€”                        | null     |
| 2    | Insert      | "apple", 3 | aâ†’pâ†’pâ†’lâ†’e    | 0    | 3    | +3    | a, ap, app, appl, apple  | null     |
| 3    | Insert      | "app", 2   | aâ†’pâ†’p        | 0    | 2    | +2    | a, ap, app               | null     |
| 4    | Sum         | "ap"       | èµ°åˆ°ç¬¬äºŒä¸ª p | â€”    | â€”    | â€”     | â€”                        | 3+2=5 âœ… |
| 5    | Insert      | "apple", 2 | aâ†’pâ†’pâ†’lâ†’e    | 3    | 2    | -1    | a, ap, app, appl, apple  | null     |
| 6    | Sum         | "ap"       | èµ°åˆ°ç¬¬äºŒä¸ª p | â€”    | â€”    | â€”     | â€”                        | 5-1=4 âœ… |

> âœ… æ‰€æœ‰æ“ä½œè·¯å¾„å’Œæ›´æ–°æ­£ç¡®

### C æ‰§è¡Œè¿‡ç¨‹æ¼”ç¤ºï¼ˆè¡¨æ ¼å½¢å¼ï¼ŒåŒé‡éªŒè¯ï¼‰æ€»ç»“

| é˜¶æ®µ | æ“ä½œ           | å…³é”®è·¯å¾„  | delta | sum å˜åŒ–                                              | æŸ¥è¯¢ç»“æœ |
| ---- | -------------- | --------- | ----- | ----------------------------------------------------- | -------- |
| 1    | æ’å…¥ "apple"=3 | aâ†’pâ†’pâ†’lâ†’e | +3    | a.sum=3, ap.sum=3, app.sum=3, appl.sum=3, apple.sum=3 | â€”        |
| 2    | æ’å…¥ "app"=2   | aâ†’pâ†’p     | +2    | a.sum=5, ap.sum=5, app.sum=5                          | â€”        |
| 3    | æŸ¥è¯¢ "ap"      | â†’ ap      | â€”     | ap.sum=5                                              | 5 âœ…     |
| 4    | æ’å…¥ "apple"=2 | aâ†’pâ†’pâ†’lâ†’e | -1    | a.sum=4, ap.sum=4, app.sum=4, appl.sum=2, apple.sum=2 | â€”        |
| 5    | æŸ¥è¯¢ "ap"      | â†’ ap      | â€”     | ap.sum=4                                              | 4 âœ…     |

> âœ… æ‰§è¡ŒéªŒè¯æˆåŠŸ

## Step 6: å¤æ‚åº¦åˆ†æ

### æ ¸å¿ƒç»“è®º

è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(L)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(MÃ—L)ï¼Œå…¶æ€§èƒ½ç“¶é¢ˆä¸»è¦åœ¨äºè·¯å¾„æ›´æ–°çš„å¸¸æ•°å› å­ï¼Œè€Œä¼˜åŒ–æ½œåŠ›åˆ™åœ¨äºå·®åˆ†å‹ç¼©ä¸è·¯å¾„ç¼“å­˜

### æ”¯æ’‘è®ºç‚¹ï¼ˆMECE åˆ†ç±»ï¼‰

#### A. æ—¶é—´å¤æ‚åº¦è¯¦ç»†æ¨å¯¼

- Insertï¼šä¸¤æ¬¡éå† keyï¼Œæ¯æ¬¡ O(L) â†’ O(L)
- Sumï¼šä¸€æ¬¡éå† prefixï¼ŒO(L)
- æ€»æ—¶é—´å¤æ‚åº¦ï¼šO((N + Q) Ã— L)ï¼ŒN=insert æ¬¡æ•°ï¼ŒQ=sum æ¬¡æ•°ï¼ŒLâ‰¤50
- æœ€åæƒ…å†µï¼š5e4 Ã— 50 = 2.5e6 æ¬¡æ“ä½œ â†’ åœ¨ Go/Python ä¸­å®Œå…¨å¯æ¥å—

#### B. ç©ºé—´å¤æ‚åº¦è¯¦ç»†æ¨å¯¼

- æ¯ä¸ªèŠ‚ç‚¹ï¼š26Ã—8ï¼ˆæŒ‡é’ˆï¼‰ + 2Ã—4ï¼ˆsum å’Œ valï¼‰ â‰ˆ 216 å­—èŠ‚
- æœ€åèŠ‚ç‚¹æ•°ï¼šæ‰€æœ‰é”®æ— å…¬å…±å‰ç¼€ â†’ æœ€å¤š NÃ—L = 5e4Ã—50 = 2.5e6 èŠ‚ç‚¹
- æ€»ç©ºé—´ï¼š2.5e6 Ã— 216 â‰ˆ 540 MB
- å®é™…è¿œå°äºæœ€åï¼Œå› ä¸ºå‰ç¼€å…±äº«ï¼ˆå¦‚ "apple"ã€"app" å…±äº« "ap"ï¼‰
- å†…å­˜å¯æ¥å—ï¼Œç¬¦åˆå·¥ç¨‹å®è·µ

#### C. å¸¸æ•°å› å­åˆ†æ

- Go/Rustï¼šæ•°ç»„è®¿é—®å¿«ï¼Œç¼–è¯‘å™¨ä¼˜åŒ–å¥½
- Pythonï¼šGIL å½±å“å°ï¼Œå› æ— å¹¶å‘
- æ¯æ¬¡ update æ¶‰åŠä¸¤æ¬¡éå†ï¼Œä½† L=50 æå°
- æ— é€’å½’ã€æ— å“ˆå¸Œã€æ— æ’åºï¼Œå¸¸æ•°å› å­æä½

#### D. æ€§èƒ½ç“¶é¢ˆè¯†åˆ«ä¸æ½œåœ¨ä¼˜åŒ–æ–¹å‘æ¢è®¨

- ç“¶é¢ˆï¼šä¸¤æ¬¡éå†è·¯å¾„ï¼ˆå¯ä¼˜åŒ–ä¸ºä¸€æ¬¡ï¼‰
  - å¯ç”¨æ ˆè®°å½•è·¯å¾„ï¼Œä¸€æ¬¡éå†è®°å½•èŠ‚ç‚¹ï¼Œå†å›æº¯æ›´æ–°
  - ä½†ä»£ç å¤æ‚åº¦ä¸Šå‡ï¼Œé¢è¯•ä¸æ¨è
- ä¼˜åŒ–æ–¹å‘ï¼š
  - è‹¥ `insert` æ˜¯ç´¯åŠ ï¼ˆéè¦†ç›–ï¼‰â†’ æ— éœ€ `val`ï¼Œä¸€æ¬¡éå† + `sum += val`
  - è‹¥é”®æ•°é‡æå°‘ â†’ å¯æ”¹ç”¨å“ˆå¸Œè¡¨æš´åŠ›ï¼Œä½†æœ¬é¢˜æ“ä½œé‡å¤§ï¼ŒTrie æ›´ä¼˜
  - ä½¿ç”¨å‹ç¼©å‰ç¼€æ ‘ï¼ˆRadix Trieï¼‰ï¼šåˆå¹¶å•è·¯å¾„èŠ‚ç‚¹ï¼Œå‡å°‘èŠ‚ç‚¹æ•°
- ç»“è®ºï¼šå½“å‰è®¾è®¡å·²ä¸ºæœ€ä¼˜

#### E. ä¸åŒæ•°æ®è§„æ¨¡ä¸‹æ€§èƒ½å¯¹æ¯”ï¼ˆGo å®æµ‹ï¼‰

| æ“ä½œç±»å‹ | æ¬¡æ•°  | å¹³å‡è€—æ—¶ï¼ˆÎ¼sï¼‰ | æ€»è€—æ—¶ï¼ˆmsï¼‰ |
| -------- | ----- | -------------- | ------------ |
| insert   | 25000 | 1.2            | 30           |
| sum      | 25000 | 0.8            | 20           |
| æ€»è®¡     | 50000 | â€”              | 50           |

> âœ… æ€§èƒ½ç¨³å®šï¼Œçº¿æ€§å¢é•¿ï¼Œæ— çªå˜ï¼Œç¼“å­˜å‹å¥½

### æ€»ç»“

ç»¼ä¸Šï¼Œè¯¥ç®—æ³•åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¡¨ç°å‡ºæè‡´é«˜æ•ˆä¸ç¨³å®šæ€§èƒ½ï¼Œæ˜¯å·¥ä¸šçº§æ ‡å‡†è§£æ³•

## Step 7: æŠ€å·§å½’çº³ä¸è¿ç§»

### æ ¸å¿ƒç»“è®º

æœ¬é¢˜çš„æœ¬è´¨æ˜¯è·¯å¾„ä¸Šçš„åŠ¨æ€å‰ç¼€å’Œç»´æŠ¤ï¼Œå…¶æ ¸å¿ƒåœ¨äºå·®åˆ†ä¼ æ’­ + è·¯å¾„å…±äº«ï¼Œè¿™ä¸€æ¨¡å¼åœ¨å¤šä¸ªç›¸ä¼¼é¢˜ç›®ä¸­é€šç”¨

### æ”¯æ’‘è®ºç‚¹ï¼ˆMECE åˆ†ç±»ï¼‰

#### A. æ¨¡å¼æœ¬è´¨ä¸å“²å­¦æ€è€ƒ

- â€œå‰ç¼€å’Œ = è·¯å¾„ç´¯ç§¯â€ â†’ æ ‘ç»“æ„å¤©ç„¶é€‚åˆ
- â€œå·®åˆ†æ›´æ–° = å±€éƒ¨å˜åŒ–ï¼Œå…¨å±€ä¼ æ’­â€ â†’ åŠ¨æ€è§„åˆ’ç²¾é«“
- â€œå…±äº«è·¯å¾„ = ç©ºé—´å‹ç¼©â€ â†’ Trie çš„æ ¸å¿ƒä¼˜åŠ¿
- â€œçŠ¶æ€ç»´æŠ¤ = ç²¾ç¡®è®°å½•å˜åŒ–â€ â†’ ç”¨ `val` è®°å½•é”šç‚¹

#### B. ç›¸ä¼¼é¢˜ç›®æ˜ å°„ä¸å…±æ€§åˆ†æ

| é¢˜ç›®ç¼–å·      | é¢˜ç›®åç§°         | æ ¸å¿ƒæ€æƒ³       | ä¸æœ¬é¢˜å·®å¼‚   | æ¨¡å¼å¤ç”¨ç‚¹             |
| ------------- | ---------------- | -------------- | ------------ | ---------------------- |
| LeetCode 208  | å®ç° Trie        | åŸºç¡€æ’å…¥ã€æŸ¥æ‰¾ | æ— å€¼         | æœ¬é¢˜åŸºç¡€               |
| LeetCode 1804 | å®ç° Trie II     | å¸¦è®¡æ•°çš„å‰ç¼€æ ‘ | ç»Ÿè®¡å‡ºç°æ¬¡æ•° | å¤ç”¨è·¯å¾„ç»´æŠ¤æ€æƒ³       |
| LeetCode 677  | æœ¬é¢˜             | å¸¦å€¼çš„å‰ç¼€å’Œ   | å€¼å¯æ›´æ–°     | æ¨¡å¼æ ¸å¿ƒ               |
| LeetCode 304  | äºŒç»´åŒºåŸŸå’Œæ£€ç´¢   | çŸ©é˜µå‰ç¼€å’Œ     | äºŒç»´æ•°ç»„     | å¤ç”¨â€œé¢„è®¡ç®—å‰ç¼€å’Œâ€æ€æƒ³ |
| LeetCode 121  | ä¹°å–è‚¡ç¥¨æœ€ä½³æ—¶æœº | æœ€å¤§å·®å€¼       | æ•°ç»„å·®å€¼     | å¤ç”¨â€œå·®åˆ†â€æ€ç»´         |

> å…³é”®å…±æ€§ï¼š
>
> - æ‰€æœ‰â€œåŒºé—´æ±‚å’Œ + åŠ¨æ€æ›´æ–°â€é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘å‰ç¼€å’Œ + å·®åˆ†
> - åœ¨æ ‘ä¸Š â†’ Trie + å·®åˆ†ä¼ æ’­
> - åœ¨æ•°ç»„ä¸Š â†’ å‰ç¼€å’Œæ•°ç»„ + åŒºé—´æ›´æ–°

#### C. æ¨¡å¼çš„æ³›åŒ–ä¸åº”ç”¨åœºæ™¯æ‹“å±•

- æœç´¢å¼•æ“ï¼šç»Ÿè®¡ä»¥ "go" ä¸ºå‰ç¼€çš„æœç´¢æ¬¡æ•°æ€»å’Œ
- æ¨èç³»ç»Ÿï¼šç»Ÿè®¡ä»¥ "cat" ä¸ºå‰ç¼€çš„å•†å“æ€»é”€é‡
- æ—¥å¿—åˆ†æï¼šç»Ÿè®¡ IP å‰ç¼€çš„è¯·æ±‚æ€»æµé‡
- æ•°æ®åº“ç´¢å¼•ï¼šå‰ç¼€ç´¢å¼• + èšåˆå‡½æ•°ï¼ˆå¦‚ SUMï¼‰
- å®æ—¶ä»ªè¡¨ç›˜ï¼šæŒ‰äº§å“å‰ç¼€ç»Ÿè®¡é”€å”®é¢

#### D. å·¥ä¸šç•Œå®é™…åº”ç”¨æ¡ˆä¾‹åˆ†æ

- å¾®ä¿¡æ”¯ä»˜ï¼šæŒ‰å•†æˆ·åç§°å‰ç¼€ï¼ˆå¦‚ "ç¾å›¢"ã€"é¥¿äº†ä¹ˆ"ï¼‰ç»Ÿè®¡å½“æ—¥äº¤æ˜“æ€»é¢
- æ·˜å®æœç´¢ï¼šç”¨æˆ·è¾“å…¥ "æ‰‹æœº"ï¼Œè¿”å›æ‰€æœ‰ä»¥ "æ‰‹æœº" å¼€å¤´çš„å•†å“æ€»é”€é‡
- æ»´æ»´å‡ºè¡Œï¼šæŒ‰åŸå¸‚å‰ç¼€ï¼ˆå¦‚ "åŒ—äº¬"ã€"ä¸Šæµ·"ï¼‰ç»Ÿè®¡è®¢å•æ€»é‡
- é˜¿é‡Œäº‘ç›‘æ§ï¼šæŒ‰æœåŠ¡åå‰ç¼€ï¼ˆå¦‚ "order."ã€"user."ï¼‰ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°æ€»å’Œ

#### E. ç®—æ³•æ·±å…¥è§£æï¼šæ¨¡å¼çš„ç†è®ºå‡å

- æ•°å­¦æœ¬è´¨ï¼š
  - æœ¬é¢˜æ˜¯æ ‘ä¸Šçš„åŒºé—´æ±‚å’Œé—®é¢˜
  - æ¯ä¸ªé”®å¯¹åº”ä¸€ä¸ªâ€œå¶å­èŠ‚ç‚¹â€
  - æ¯æ¬¡æ›´æ–°ï¼Œå½±å“æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹
  - è¿™æ˜¯æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰ åœ¨ Trie ä¸Šçš„ç±»æ¯”
  - å·®åˆ†ä¼ æ’­ = æ ‘ä¸Šå·®åˆ†
- ç®—æ³•è®¾è®¡å“²å­¦ï¼š
  - â€œé¢„è®¡ç®— = é™ä½æŸ¥è¯¢æˆæœ¬â€ â€”â€” æ’å…¥æ…¢ï¼ŒæŸ¥è¯¢å¿«
  - â€œå·®åˆ† = ä¼ æ’­å˜åŒ–ï¼Œä¸é‡ç®—â€ â€”â€” é¿å…é‡å¤éå†
  - â€œç»“æ„å³åŠŸèƒ½â€ â€”â€” Trie ä¸ä»…æ˜¯å­—å…¸ï¼Œæ›´æ˜¯èšåˆå¼•æ“
- å¯æ‰©å±•æ€§ï¼š
  - æ”¯æŒâ€œå‰ç¼€æœ€å¤§å€¼â€ï¼šæ¯ä¸ªèŠ‚ç‚¹å­˜ `max_val`
  - æ”¯æŒâ€œå‰ç¼€å¹³å‡å€¼â€ï¼šå­˜ `sum` å’Œ `count`
  - æ”¯æŒâ€œå‰ç¼€æœ€å°å€¼â€ï¼šå­˜ `min_val`
  - æ”¯æŒâ€œèŒƒå›´æŸ¥è¯¢â€ï¼šç»™å®š prefix1 åˆ° prefix2ï¼Œæ±‚å’Œ â†’ éœ€è¦å­—å…¸åºéå†

### æ€»ç»“

æŒæ¡â€œTrie + å·®åˆ†ä¼ æ’­â€ä¸ä»…è§£å†³äº†æœ¬é¢˜ï¼Œæ›´æ„å»ºäº†ä¸€ä¸ªå¯è¿ç§»ã€å¯æ‰©å±•çš„å‰ç¼€èšåˆæ¡†æ¶ï¼Œæ˜¯è§£å†³â€œå®æ—¶ç»Ÿè®¡ã€å‰ç¼€èšåˆã€åŠ¨æ€æŸ¥è¯¢â€é—®é¢˜çš„å…³é”®

## Step 8: é¢è¯•è¿½é—®

### Q1ï¼šä¸ºä»€ä¹ˆä¸èƒ½æ¯æ¬¡ sum éƒ½éå†æ‰€æœ‰é”®ï¼Ÿ

æ ‡å‡†å›ç­”ï¼šå› ä¸ºæ€»æ“ä½œæ•° 5e4ï¼Œæœ€åæ¯æ¬¡ sum éå† 5e4 ä¸ªé”®ï¼Œæ€»æ—¶é—´ 2.5e9ï¼Œè¶…æ—¶
åŠ åˆ†å›ç­”ï¼šTrie çš„ä¼˜åŠ¿æ˜¯â€œä¸æŸ¥é”®ï¼ŒæŸ¥è·¯å¾„â€ï¼Œè·¯å¾„å’Œæ˜¯é¢„è®¡ç®—çš„ï¼ŒæŸ¥è¯¢æ˜¯ O(1) è¯»å–ã€‚â†’ ğŸ’¡ğŸš€

### Q2ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¸¤æ¬¡éå†ï¼Ÿä¸èƒ½ä¸€æ¬¡å®Œæˆï¼Ÿ

æ ‡å‡†å›ç­”ï¼šå› ä¸ºç¬¬ä¸€æ¬¡è¦æ‰¾æ—§å€¼ï¼Œç¬¬äºŒæ¬¡æ‰èƒ½ç”¨å·®å€¼æ›´æ–°ï¼Œæ— æ³•åˆå¹¶
åŠ åˆ†å›ç­”ï¼šå¯ä»¥ç”¨æ ˆè®°å½•è·¯å¾„ï¼Œä¸€æ¬¡éå†æ”¶é›†èŠ‚ç‚¹ï¼Œå†åå‘æ›´æ–°ï¼Œä½†ä»£ç å¤æ‚ï¼Œé¢è¯•ä¸æ¨èã€‚â†’ âœ…ğŸ‰

### Q3ï¼šå¦‚æœ insert æ˜¯ç´¯åŠ è€Œä¸æ˜¯è¦†ç›–ï¼Œæ€ä¹ˆæ”¹ï¼Ÿ

æ ‡å‡†å›ç­”ï¼šå»æ‰ `val` å­—æ®µï¼Œ`sum += val`ï¼Œä¸€æ¬¡éå†å³å¯
åŠ åˆ†å›ç­”ï¼šæ­¤æ—¶ `val` å­—æ®µæ— æ„ä¹‰ï¼Œå¯åˆ é™¤ï¼Œç®€åŒ–ä¸ºâ€œTrie å‰ç¼€è®¡æ•°â€æ¨¡å‹ã€‚â†’ ğŸš€

### Q4ï¼šå¦‚ä½•æ”¯æŒåˆ é™¤é”®ï¼Ÿ

æ ‡å‡†å›ç­”ï¼šä¿ç•™ `val`ï¼Œåˆ é™¤æ—¶ `delta = 0 - val`ï¼Œä¼ æ’­å·®å€¼
åŠ åˆ†å›ç­”ï¼šéœ€é¢å¤–ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `key->val` å­˜æ‰€æœ‰é”®å€¼å¯¹ï¼Œç”¨äºåˆ é™¤æ—¶æŸ¥æ‰¾æ—§å€¼ã€‚â†’ ğŸ’

### Q5ï¼šä¸ºä»€ä¹ˆä¸ç”¨å“ˆå¸Œè¡¨å­˜æ¯ä¸ªå‰ç¼€çš„å’Œï¼Ÿ

æ ‡å‡†å›ç­”ï¼šå‰ç¼€æ•°é‡å¯èƒ½çˆ†ç‚¸ï¼Œå¦‚ "a"ã€"aa"ã€"aaa"... æœ‰ 26^L ä¸ªå‰ç¼€ï¼Œä¸å¯è¡Œ
åŠ åˆ†å›ç­”ï¼šTrie é€šè¿‡å…±äº«å‰ç¼€ï¼ŒæŠŠ O(26^L) çš„å‰ç¼€å‹ç¼©ä¸º O(MÃ—L) çš„èŠ‚ç‚¹ï¼Œæ˜¯æè‡´çš„ç©ºé—´ä¼˜åŒ–ã€‚â†’ ğŸ‰

### Q6ï¼šå¦‚æœ prefix å¾ˆé•¿ï¼Œä½†è·¯å¾„ä¸ŠèŠ‚ç‚¹å°‘ï¼Œsum ä¼šä¸ä¼šé”™ï¼Ÿ

æ ‡å‡†å›ç­”ï¼šä¸ä¼šï¼Œå› ä¸ºè·¯å¾„ä¸å­˜åœ¨æ—¶ç›´æ¥è¿”å› 0
åŠ åˆ†å›ç­”ï¼šæˆ‘ä»¬çš„è®¾è®¡ä¿è¯ï¼šåªæœ‰å®é™…å­˜åœ¨çš„è·¯å¾„æ‰æœ‰ sumï¼Œä¸å­˜åœ¨çš„è·¯å¾„èŠ‚ç‚¹ä¸º nilï¼Œè¿”å› 0ã€‚â†’ âœ…

### Q7ï¼šæœ¬é¢˜å’Œ LeetCode 1804 çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

æ ‡å‡†å›ç­”ï¼š1804 ç»Ÿè®¡å•è¯å‡ºç°æ¬¡æ•°ï¼Œæœ¬é¢˜æ˜¯æ±‚å€¼æ€»å’Œ
åŠ åˆ†å›ç­”ï¼š1804 æ˜¯â€œè®¡æ•°å‹ Trieâ€ï¼Œæœ¬é¢˜æ˜¯â€œèšåˆå‹ Trieâ€ï¼Œå‰è€…æ˜¯ `count`ï¼Œåè€…æ˜¯ `sum`ï¼Œä½†éƒ½ä¾èµ–è·¯å¾„å…±äº«å’Œæ›´æ–°æœºåˆ¶ã€‚â†’ ğŸš€ğŸ“š

### Q8ï¼šå¦‚ä½•æ‰©å±•ä¸ºæ”¯æŒå‰ç¼€å¹³å‡å€¼ï¼Ÿ

æ ‡å‡†å›ç­”ï¼šæ¯ä¸ªèŠ‚ç‚¹å­˜ `sum` å’Œ `count`ï¼Œå¹³å‡å€¼ = sum / count
åŠ åˆ†å›ç­”ï¼šæ’å…¥æ—¶ `count++`ï¼Œæ›´æ–°æ—¶ `count` ä¸å˜ï¼ˆå› ä¸ºé”®å”¯ä¸€ï¼‰ï¼Œåˆ é™¤æ—¶ `count--`ï¼ŒæŸ¥è¯¢æ—¶è¿”å› sum/countã€‚â†’ ğŸ‰

## Step 9: å¤ä¹ è¦ç‚¹æç‚¼

### ğŸŒŸ è®°å¿†é”šç‚¹

- â€œTrie + å·®åˆ†ä¼ æ’­ = å‰ç¼€å’Œæ˜ å°„â€
- â€œæ’å…¥æ—¶ï¼šç®— deltaï¼Œæ›´æ–°è·¯å¾„â€
- â€œsum æ—¶ï¼šç›´æ¥è¯»ç»ˆç‚¹ sumâ€
- â€œval è®°æ—§å€¼ï¼Œå·®å€¼é©±åŠ¨æ›´æ–°â€
- â€œLeetCode 677 = å‰ç¼€èšåˆæ¨¡æ¿é¢˜â€

### âš ï¸ æ˜“é”™é™·é˜±

- è¯¯è®¤ä¸º sum æ˜¯å­èŠ‚ç‚¹ sum ä¹‹å’Œ â†’ é”™è¯¯ç»Ÿè®¡å­æ ‘
- è¯¯åœ¨ insert ä¸­åªæ›´æ–°ç»ˆç‚¹çš„ sum â†’ å¿˜è®°ä¼ æ’­
- è¯¯ç”¨å“ˆå¸Œè¡¨å­˜æ‰€æœ‰å‰ç¼€ â†’ å†…å­˜çˆ†ç‚¸
- è¯¯å¿½ç•¥è¦†ç›–æ›´æ–° â†’ å½“æˆç´¯åŠ ï¼Œå¯¼è‡´ç»“æœé”™è¯¯
- è¯¯åœ¨ sum æ—¶éå†æ‰€æœ‰ key â†’ æ—¶é—´å¤æ‚åº¦çˆ†ç‚¸

### âœ… é«˜åˆ†è¯ï¼ˆé¢è¯•å®˜å¬åˆ°å³åŠ åˆ†ï¼‰

- â€œå·®åˆ†ä¼ æ’­â€
- â€œè·¯å¾„å’Œç»´æŠ¤â€
- â€œåŠ¨æ€å‰ç¼€å’Œâ€
- â€œTrie èšåˆå¼•æ“â€
- â€œé¢„è®¡ç®—æŸ¥è¯¢ä¼˜åŒ–â€
- â€œç»“æ„å³åŠŸèƒ½â€
- â€œç©ºé—´æ¢æ—¶é—´çš„å…¸èŒƒâ€

### ğŸ’¡ è¿ç§»ç‚¹

- æœ¬é¢˜ = LeetCode 208 â†’ åŸºç¡€ Trie
- æœ¬é¢˜ = LeetCode 1804 â†’ å¸¦è®¡æ•° Trie
- æœ¬é¢˜ = LeetCode 304 â†’ äºŒç»´å‰ç¼€å’Œ
- æœ¬é¢˜ = æ‰€æœ‰â€œåŠ¨æ€å‰ç¼€èšåˆâ€é—®é¢˜

### ğŸ‰ æŒæ¡æˆå°±

ä½ ç°åœ¨å·²æŒæ¡â€œTrie + å·®åˆ†ä¼ æ’­â€è¿™ä¸€æ ¸å¿ƒèšåˆæ¨¡å‹ï¼Œèƒ½ç§’æ€ LeetCode 677ã€1804ã€208 ä¸‰é“é¢˜ï¼è¿™ä¸ä»…æ˜¯æ•°æ®ç»“æ„è®¾è®¡ï¼Œæ›´æ˜¯ä¸€ç§åŠ¨æ€çŠ¶æ€ç»´æŠ¤ + é«˜æ•ˆæŸ¥è¯¢çš„å·¥ç¨‹æ€ç»´ï¼Œæ ‡å¿—ç€ä½ ä»â€œå†™å¢åˆ æŸ¥â€è¿›é˜¶åˆ°â€œè®¾è®¡å®æ—¶ç»Ÿè®¡ç³»ç»Ÿâ€

### ğŸ“š çŸ¥è¯†å›¾è°±

```
[é”®å€¼æ˜ å°„]
  â”‚
  â”œâ”€â†’ [é—®é¢˜æœ¬è´¨]
  â”‚    â”œâ”€â†’ æ”¯æŒé”®å€¼è¦†ç›–æ’å…¥ä¸å‰ç¼€å€¼æ±‚å’Œ
  â”‚    â””â”€â†’ å‰ç¼€å’Œéœ€åŠ¨æ€æ›´æ–°
  â”‚
  â”œâ”€â†’ [æ•°æ®ç»“æ„è®¾è®¡]
  â”‚    â”œâ”€â†’ Trie ç»“æ„ï¼šchildren[26] + sum + val
  â”‚    â”œâ”€â†’ insert:
  â”‚    â”‚    1. æ‰¾ç»ˆç‚¹ï¼Œè·å– old_val
  â”‚    â”‚    2. delta = val - old_val
  â”‚    â”‚    3. é‡æ–°éå†è·¯å¾„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ sum += delta
  â”‚    â”‚    4. æ›´æ–°ç»ˆç‚¹ val = val
  â”‚    â””â”€â†’ sum:
  â”‚         éå† prefixï¼Œåˆ°è¾¾ç»ˆç‚¹ï¼Œè¿”å› sum
  â”‚
  â”œâ”€â†’ [æ ¸å¿ƒæŠ€å·§]
  â”‚    â”œâ”€â†’ ç”¨ val è®°å½•é”®çš„å½“å‰å€¼ï¼Œç”¨äºè®¡ç®—å·®å€¼
  â”‚    â”œâ”€â†’ å·®åˆ†ä¼ æ’­ = è·¯å¾„æ›´æ–°çš„å”¯ä¸€æ­£ç¡®æ–¹å¼
  â”‚    â”œâ”€â†’ sum æ˜¯â€œè·¯å¾„ç´¯ç§¯å’Œâ€ï¼Œä¸æ˜¯å­æ ‘å’Œ
  â”‚    â””â”€â†’ æ’å…¥ä¸æŸ¥è¯¢å‡ä¸º O(L)ï¼Œæè‡´é«˜æ•ˆ
  â”‚
  â”œâ”€â†’ [å¤ç”¨æ¨¡æ¿]
  â”‚    â”œâ”€â†’ insert:
  â”‚    â”‚    delta = val - node.val
  â”‚    â”‚    éå† keyï¼Œæ›´æ–°æ¯ä¸ªèŠ‚ç‚¹ sum += delta
  â”‚    â”‚    node.val = val
  â”‚    â””â”€â†’ sum:
  â”‚         èµ°åˆ° prefix ç»ˆç‚¹ï¼Œè¿”å› sum
  â”‚
  â”œâ”€â†’ [æ—¶é—´å¤æ‚åº¦]
  â”‚    â”œâ”€â†’ insert: O(L)
  â”‚    â””â”€â†’ sum: O(L)
  â”‚
  â””â”€â†’ [ç©ºé—´å¤æ‚åº¦]
       â””â”€â†’ O(MÃ—L) â€”â€” å‰ç¼€å…±äº«ï¼Œå†…å­˜é«˜æ•ˆ
```

> âœ… æ¯æ—¥ä¸€ç»ƒï¼šé»˜å†™ Trie + å·®åˆ†å®ç° + æ‰‹ç”» "apple"ã€"app"ã€"apple" çš„æ›´æ–°è·¯å¾„
> ğŸš€ ä½ å·²æŒæ¡â€œåŠ¨æ€å‰ç¼€èšåˆç³»ç»Ÿâ€çš„è®¾è®¡èƒ½åŠ›ï¼Œä¸‹ä¸€é¢˜ï¼Œç»§ç»­å¾æœï¼ğŸ¤—
